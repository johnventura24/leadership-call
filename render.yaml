services:
  # RAG API Service
  - type: web
    name: leadership-rag-api
    env: python
    region: oregon
    plan: free  # Start with free tier, upgrade to starter ($7/month) when needed
    buildCommand: pip install -r requirements.txt
    startCommand: python api_service.py
    healthCheckPath: /health
    envVars:
      - key: OPENAI_API_KEY
        sync: false  # Set manually in Render dashboard for security
      - key: API_TOKEN
        sync: false  # Set manually in Render dashboard for security
      - key: GOOGLE_CREDENTIALS_JSON
        sync: false  # Set manually in Render dashboard for security
      - key: ENVIRONMENT
        value: production
      - key: PORT
        value: 8000
      - key: VECTOR_STORE_PATH
        value: /app/vector_store
      - key: EMBEDDING_MODEL
        value: text-embedding-ada-002
      - key: QA_MODEL
        value: gpt-3.5-turbo
      - key: MAX_TOKENS
        value: 1000
      - key: TEMPERATURE
        value: 0.7
      - key: CHUNK_SIZE
        value: 1000
      - key: CHUNK_OVERLAP
        value: 200
      - key: LOAD_DOCS_ON_STARTUP
        value: true
      - key: GOOGLE_CREDENTIALS_PATH
        value: /app/credentials.json
      - key: GOOGLE_TOKEN_PATH
        value: /app/token.json

  # PostgreSQL Database
  - type: pserv
    name: leadership-rag-postgres
    env: docker
    repo: https://github.com/render-examples/postgresql.git
    region: oregon
    plan: free  # 90 days free, then $7/month
    disk:
      name: postgres-data
      mountPath: /var/lib/postgresql/data
      sizeGB: 1
    envVars:
      - key: POSTGRES_DB
        value: leadership_kb
      - key: POSTGRES_USER
        value: rag_user
      - key: POSTGRES_PASSWORD
        generateValue: true

  # Redis Database  
  - type: pserv
    name: leadership-rag-redis
    env: docker
    repo: https://github.com/render-examples/redis.git
    region: oregon
    plan: free  # 90 days free, then $7/month
    disk:
      name: redis-data
      mountPath: /data
      sizeGB: 1